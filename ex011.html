<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sistema com Pastas Estilizadas</title>

<style>
:root { 
    --primary:#F875AA; 
    --secondary:#AEDEFC; 
}

body { 
    font-family: Arial,sans-serif; 
    background:linear-gradient(135deg,var(--primary),var(--secondary)); 
    padding:20px; 
}

.container { 
    background:white; 
    padding:25px; 
    border-radius:10px; 
    box-shadow:0 8px 20px rgba(0,0,0,0.15); 
}

input, button { 
    padding:8px; 
    margin:5px 0; 
    border-radius:5px; 
    border:1px solid #ccc; 
}

button { 
    background:var(--primary); 
    color:white; 
    border:none; 
    cursor:pointer; 
}

button:hover { opacity:0.85; }

.btn-excluir { background:#d32f2f; }

/* ===== PASTA DESENHO ===== */

.folder {
    position: relative;
    display:inline-block;
    width:120px;
    height:80px;
    margin:15px;
    background:#F875AA;
    border-radius:12px;
    cursor:pointer;
    transition:0.3s;
    box-shadow:0 6px 12px rgba(0,0,0,0.15);
    color:white;
    font-weight:bold;
    text-align:center;
    padding-top:35px;
}

.folder::before {
    content:"";
    position:absolute;
    top:-15px;
    left:15px;
    width:60px;
    height:25px;
    background:#f9a9c3;
    border-radius:8px 8px 0 0;
}

.folder:hover { transform:scale(1.05); }

.folder.active { background:#d95b95; }

.folder button {
    position:absolute;
    top:5px;
    background:#d32f2f;
    border:none;
    color:white;
    border-radius:50%;
    width:20px;
    height:20px;
    font-size:12px;
    cursor:pointer;
}

.folder .btn-excluir { right:5px; }

.folder .btn-renomear { 
    right:30px; 
    background:#555;
}

table { width:100%; border-collapse:collapse; margin-top:20px; }
th, td { border:1px solid #ddd; padding:8px; text-align:center; }
th { background:var(--primary); color:white; }

.draggable { cursor:grab; }
.drop-hover { outline:3px dashed var(--primary); }

</style>
</head>

<body>

<div class="container">

<h2>Sistema Organizado por Pastas</h2>

<div>
<input type="text" id="nome" placeholder="Nome">
<input type="email" id="email" placeholder="E-mail">
<input type="text" id="documento" placeholder="CPF/CNPJ">
<input type="text" id="motivo" placeholder="Motivo">
<input type="text" id="submotivo" placeholder="Sub-Motivo">
<input type="date" id="data">
<input type="text" id="protocolo" placeholder="Protocolo">
<button onclick="salvarRegistro()">Salvar</button>
</div>

<hr>

<h3>Pastas</h3>

<input type="text" id="novaPasta" placeholder="Ex: 03/2026">
<button onclick="criarPasta()">Criar Pasta</button>
<button onclick="mostrarTodos()">Mostrar Todos</button>

<div id="listaPastas"></div>

<hr>

<input type="text" id="busca" placeholder="Buscar por Nome, CPF ou Protocolo">
<button onclick="buscarRegistro()">Buscar</button>

<table>
<thead>
<tr>
<th>Nome</th>
<th>Email</th>
<th>CPF/CNPJ</th>
<th>Motivo</th>
<th>Sub-Motivo</th>
<th>Data</th>
<th>Protocolo</th>
<th>Pasta</th>
<th>Ações</th>
</tr>
</thead>
<tbody id="tbody"></tbody>
</table>

</div>

<script>

let pastas = JSON.parse(localStorage.getItem('pastas')) || [];
let registros = JSON.parse(localStorage.getItem('registros')) || [];
let pastaAtual = null;

function salvarStorage(){
    localStorage.setItem('pastas', JSON.stringify(pastas));
    localStorage.setItem('registros', JSON.stringify(registros));
}

function criarPasta(){
    const nome = document.getElementById('novaPasta').value.trim();
    if(!nome) return alert('Digite o mês/ano da pasta');
    if(pastas.includes(nome)) return alert('Pasta já existe');

    pastas.push(nome);
    salvarStorage();
    renderPastas();
    document.getElementById('novaPasta').value='';
}

function renderPastas(){
    const div = document.getElementById('listaPastas');
    div.innerHTML='';

    pastas.forEach(p=>{
        const pastaDiv=document.createElement('div');
        pastaDiv.className='folder'+(p===pastaAtual?' active':'');
        pastaDiv.textContent=p;
        pastaDiv.onclick=()=>abrirPasta(p);

        // Excluir
        const btnExcluir = document.createElement('button');
        btnExcluir.textContent = 'x';
        btnExcluir.className='btn-excluir';
        btnExcluir.onclick = (e)=>{
            e.stopPropagation();
            excluirPasta(p);
        };

        // Renomear
        const btnRenomear = document.createElement('button');
        btnRenomear.textContent = '✏';
        btnRenomear.className='btn-renomear';
        btnRenomear.onclick = (e)=>{
            e.stopPropagation();
            renomearPasta(p);
        };

        pastaDiv.appendChild(btnExcluir);
        pastaDiv.appendChild(btnRenomear);

        pastaDiv.ondragover=(e)=>{ e.preventDefault(); pastaDiv.classList.add('drop-hover'); }
        pastaDiv.ondragleave=()=>pastaDiv.classList.remove('drop-hover');
        pastaDiv.ondrop=(e)=>{
            e.preventDefault();
            const protocolo=e.dataTransfer.getData('text');
            moverParaPasta(protocolo,p);
            pastaDiv.classList.remove('drop-hover');
        }

        div.appendChild(pastaDiv);
    });
}

function abrirPasta(nome){
    pastaAtual=nome;
    renderPastas();
    renderTabela(registros.filter(r=>r.pasta===nome));
}

function mostrarTodos(){
    pastaAtual=null;
    renderPastas();
    renderTabela(registros);
}

function salvarRegistro(){
    const protocolo=document.getElementById('protocolo').value.trim();
    if(!protocolo) return alert('Informe o protocolo');

    registros.push({
        nome:document.getElementById('nome').value,
        email:document.getElementById('email').value,
        documento:document.getElementById('documento').value,
        motivo:document.getElementById('motivo').value,
        submotivo:document.getElementById('submotivo').value,
        data:document.getElementById('data').value,
        protocolo:protocolo,
        pasta:pastaAtual
    });

    salvarStorage();
    renderTabela(registros);
}

function renderTabela(lista){
    const tbody=document.getElementById('tbody');
    tbody.innerHTML='';

    lista.forEach(r=>{
        const tr=document.createElement('tr');
        tr.className='draggable';
        tr.draggable=true;

        tr.ondragstart=(e)=>{ e.dataTransfer.setData('text',r.protocolo); }

        tr.innerHTML=`
            <td>${r.nome||''}</td>
            <td>${r.email||''}</td>
            <td>${r.documento||''}</td>
            <td>${r.motivo||''}</td>
            <td>${r.submotivo||''}</td>
            <td>${r.data||''}</td>
            <td>${r.protocolo}</td>
            <td>${r.pasta||''}</td>
            <td><button class='btn-excluir' onclick="excluirRegistro('${r.protocolo}')">Excluir</button></td>
        `;
        tbody.appendChild(tr);
    });
}

function moverParaPasta(protocolo,pastaDestino){
    registros=registros.map(r=>{
        if(r.protocolo===protocolo){ r.pasta=pastaDestino; }
        return r;
    });

    salvarStorage();
    mostrarTodos();
}

function excluirRegistro(protocolo){
    if(!confirm('Deseja excluir?')) return;
    registros=registros.filter(r=>r.protocolo!==protocolo);
    salvarStorage();
    mostrarTodos();
}

function excluirPasta(nome){
    if(!confirm('Deseja excluir a pasta?')) return;

    pastas = pastas.filter(p=>p!==nome);
    registros = registros.map(r=>{
        if(r.pasta===nome){ r.pasta=null; }
        return r;
    });

    if(pastaAtual===nome) pastaAtual=null;

    salvarStorage();
    renderPastas();
    mostrarTodos();
}

function renomearPasta(nomeAntigo){
    const novoNome = prompt('Digite o novo nome da pasta:', nomeAntigo);

    if(!novoNome || novoNome.trim()==='') return;
    if(pastas.includes(novoNome)) return alert('Já existe uma pasta com esse nome');

    pastas = pastas.map(p => p===nomeAntigo ? novoNome : p);

    registros = registros.map(r=>{
        if(r.pasta===nomeAntigo){
            r.pasta = novoNome;
        }
        return r;
    });

    if(pastaAtual===nomeAntigo){
        pastaAtual = novoNome;
    }

    salvarStorage();
    renderPastas();
    mostrarTodos();
}

function buscarRegistro(){
    const termo=document.getElementById('busca').value.toLowerCase();

    renderTabela(
        registros.filter(r=>
            (r.nome||'').toLowerCase().includes(termo)||
            (r.documento||'').includes(termo)||
            (r.protocolo||'').toLowerCase().includes(termo)
        )
    );
}

renderPastas();
renderTabela(registros);

</script>

</body>
</html>
